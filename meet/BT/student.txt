// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract StudentRegistry {
    struct Student {
        uint256 id;
        string name;
        uint8 age;
        string department;
    }

    Student[] public students;                // Arrays
    mapping(uint256 => uint256) private idx;  // id => index+1

    event StudentAdded(uint256 id, string name);
    event StudentUpdated(uint256 id);

    // Fallback/receive to accept ETH (for demo)
    receive() external payable {}
    fallback() external payable {}

    function addStudent(uint256 id, string calldata name, uint8 age, string calldata department) external {
        require(idx[id] == 0, "ID exists");
        students.push(Student(id, name, age, department));
        idx[id] = students.length; // store index+1
        emit StudentAdded(id, name);
    }

    function updateStudent(uint256 id, string calldata name, uint8 age, string calldata department) external {
        uint256 i = idx[id];
        require(i != 0, "Not found");
        students[i-1] = Student(id, name, age, department);
        emit StudentUpdated(id);
    }

    function getStudent(uint256 id) external view returns (Student memory) {
        uint256 i = idx[id];
        require(i != 0, "Not found");
        return students[i-1];
    }

    function studentsCount() external view returns (uint256) {
        return students.length;
    }
}
